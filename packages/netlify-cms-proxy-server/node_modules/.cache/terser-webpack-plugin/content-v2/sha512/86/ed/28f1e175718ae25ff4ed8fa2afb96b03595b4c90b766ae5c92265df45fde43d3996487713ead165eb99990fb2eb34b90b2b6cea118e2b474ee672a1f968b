{"map":"{\"version\":3,\"sources\":[\"index.js\"],\"names\":[\"module\",\"exports\",\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"i\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"require\",\"__importDefault\",\"this\",\"mod\",\"default\",\"joi\",\"defaultSchema\",\"joi_1\",\"allowedActions\",\"requiredString\",\"string\",\"required\",\"requiredNumber\",\"number\",\"requiredBool\",\"bool\",\"collection\",\"slug\",\"path\",\"defaultParams\",\"branch\",\"asset\",\"content\",\"encoding\",\"valid\",\"dataFile\",\"raw\",\"newPath\",\"optional\",\"params\",\"when\",\"switch\",\"is\",\"then\",\"allow\",\"keys\",\"folder\",\"extension\",\"depth\",\"files\",\"array\",\"items\",\"label\",\"id\",\"cmsLabelPrefix\",\"entry\",\"dataFiles\",\"assets\",\"options\",\"collectionName\",\"commitMessage\",\"useWorkflow\",\"status\",\"xor\",\"newStatus\",\"mediaFolder\",\"paths\",\"min\",\"otherwise\",\"forbidden\",\"action\",\"schema\",\"req\",\"res\",\"next\",\"error\",\"validate\",\"body\",\"allowUnknown\",\"details\",\"message\",\"map\",\"join\",\"json\",\"pathTraversal\",\"path_1\",\"repoPath\",\"extend\",\"type\",\"base\",\"messages\",\"path.invalid\",\"[object Object]\",\"helpers\",\"startsWith\",\"errors\",\"getUpdateDate\",\"move\",\"deleteFile\",\"writeFile\",\"listRepoFiles\",\"fs_1\",\"listFiles\",\"async\",\"dir\",\"dirents\",\"promises\",\"readdir\",\"withFileTypes\",\"Promise\",\"all\",\"dirent\",\"isDirectory\",\"filter\",\"f\",\"endsWith\",\"concat\",\"e\",\"substr\",\"length\",\"filePath\",\"mkdir\",\"dirname\",\"recursive\",\"unlink\",\"catch\",\"moveFile\",\"from\",\"to\",\"rename\",\"sourceDir\",\"destDir\",\"allFiles\",\"file\",\"replace\",\"stat\",\"mtime\",\"Date\",\"readMediaFile\",\"entriesFromFiles\",\"crypto_1\",\"sha256\",\"buffer\",\"createHash\",\"update\",\"digest\",\"normalizePath\",\"readFile\",\"data\",\"toString\",\"basename\",\"registerCommonMiddlewares\",\"express_1\",\"morgan_1\",\"cors_1\",\"app\",\"logger\",\"stream\",\"write\",\"debug\",\"String\",\"trim\",\"use\",\"limit\",\"registerMiddleware\",\"localGitMiddleware\",\"getSchema\",\"validateRepo\",\"APIUtils_1\",\"what_the_diff_1\",\"promise_1\",\"async_mutex_1\",\"customValidators_1\",\"fs_2\",\"entries_1\",\"commit\",\"git\",\"add\",\"undefined\",\"--no-verify\",\"--no-gpg-sign\",\"getCurrentBranch\",\"branchLocal\",\"summary\",\"current\",\"runOnBranch\",\"func\",\"currentBranch\",\"checkout\",\"branchDescription\",\"commitEntry\",\"a\",\"Buffer\",\"every\",\"forEach\",\"isBranchExists\",\"includes\",\"getDiffs\",\"source\",\"dest\",\"rawDiff\",\"diff\",\"parse\",\"_a\",\"_b\",\"oldPath\",\"newFile\",\"binary\",\"test\",\"silent\",\"checkIsRepo\",\"Error\",\"mutex\",\"withTimeout\",\"Mutex\",\"release\",\"acquire\",\"repo\",\"publish_modes\",\"payload\",\"entries\",\"cmsBranches\",\"result\",\"b\",\"CMS_BRANCH_PREFIX\",\"contentKeyFromBranch\",\"parseContentKey\",\"contentKey\",\"generateContentKey\",\"cmsBranch\",\"branchFromContentKey\",\"diffs\",\"labelToStatus\",\"updatedAt\",\"reduce\",\"unpublishedEntry\",\"checkoutLocalBranch\",\"branchExists\",\"gpgSign\",\"addConfig\",\"rebase\",\"toDelete\",\"description\",\"statusToLabel\",\"mergeFromTo\",\"merge\",\"deleteLocalBranch\",\"mediaFiles\",\"mediaFile\",\"JSON\",\"stringify\",\"resolve\",\"process\",\"env\",\"GIT_REPO_DIRECTORY\",\"cwd\",\"post\",\"info\",\"isCMSLabel\",\"MERGE_COMMIT_MESSAGE\",\"DEFAULT_PR_BODY\",\"getLabelPrefix\",\"labelPrefix\",\"index\",\"indexOf\",\"substring\",\"localFsMiddleware\",\"createLogger\",\"winston_1\",\"combine\",\"colorize\",\"simple\",\"format\",\"level\",\"transports\",\"Console\",\"config\",\"common_1\",\"localGit_1\",\"localFs_1\",\"logger_1\",\"port\",\"PORT\",\"LOG_LEVEL\",\"MODE\",\"exit\",\"listen\"],\"mappings\":\"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\"}","code":"#!/usr/bin/env node\nmodule.exports=function(e){var t={};function a(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)a.d(i,r,function(t){return e[t]}.bind(null,r));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,\"a\",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p=\"\",a(a.s=20)}([function(e,t){e.exports=require(\"path\")},function(e,t){e.exports=require(\"fs\")},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.joi=t.defaultSchema=void 0;const r=i(a(3)),s=[\"info\",\"entriesByFolder\",\"entriesByFiles\",\"getEntry\",\"unpublishedEntries\",\"unpublishedEntry\",\"unpublishedEntryDataFile\",\"unpublishedEntryMediaFile\",\"deleteUnpublishedEntry\",\"persistEntry\",\"updateUnpublishedEntryStatus\",\"publishUnpublishedEntry\",\"getMedia\",\"getMediaFile\",\"persistMedia\",\"deleteFile\",\"deleteFiles\",\"getDeployPreview\"],n=r.default.string().required(),o=r.default.number().required(),l=r.default.bool().required(),c=n,d=n;t.defaultSchema=({path:e=n}={})=>{const t=r.default.object({branch:n}),a=r.default.object({path:e,content:n,encoding:n.valid(\"base64\")}),i=r.default.object({slug:n,path:e,raw:n,newPath:e.optional()}),u=r.default.when(\"action\",{switch:[{is:\"info\",then:r.default.allow()},{is:\"entriesByFolder\",then:t.keys({folder:e,extension:n,depth:o}).required()},{is:\"entriesByFiles\",then:t.keys({files:r.default.array().items(r.default.object({path:e,label:r.default.string()})).required()})},{is:\"getEntry\",then:t.keys({path:e}).required()},{is:\"unpublishedEntries\",then:t.keys({branch:n}).required()},{is:\"unpublishedEntry\",then:t.keys({id:r.default.string().optional(),collection:r.default.string().optional(),slug:r.default.string().optional(),cmsLabelPrefix:r.default.string().optional()}).required()},{is:\"unpublishedEntryDataFile\",then:t.keys({collection:c,slug:d,id:n,path:n}).required()},{is:\"unpublishedEntryMediaFile\",then:t.keys({collection:c,slug:d,id:n,path:n}).required()},{is:\"deleteUnpublishedEntry\",then:t.keys({collection:c,slug:d}).required()},{is:\"persistEntry\",then:t.keys({cmsLabelPrefix:r.default.string().optional(),entry:i,dataFiles:r.default.array().items(i),assets:r.default.array().items(a).required(),options:r.default.object({collectionName:r.default.string(),commitMessage:n,useWorkflow:l,status:n}).required()}).xor(\"entry\",\"dataFiles\").required()},{is:\"updateUnpublishedEntryStatus\",then:t.keys({collection:c,slug:d,newStatus:n,cmsLabelPrefix:r.default.string().optional()}).required()},{is:\"publishUnpublishedEntry\",then:t.keys({collection:c,slug:d}).required()},{is:\"getMedia\",then:t.keys({mediaFolder:e}).required()},{is:\"getMediaFile\",then:t.keys({path:e}).required()},{is:\"persistMedia\",then:t.keys({asset:a.required(),options:r.default.object({commitMessage:n}).required()}).required()},{is:\"deleteFile\",then:t.keys({path:e,options:r.default.object({commitMessage:n}).required()}).required()},{is:\"deleteFiles\",then:t.keys({paths:r.default.array().items(e).min(1).required(),options:r.default.object({commitMessage:n}).required()}).required()},{is:\"getDeployPreview\",then:t.keys({collection:c,slug:d}).required()}],otherwise:r.default.forbidden()});return r.default.object({action:r.default.valid(...s).required(),params:u})},t.joi=e=>(t,a,i)=>{const{error:r}=e.validate(t.body,{allowUnknown:!0});if(r){const{details:e}=r,t=e.map(e=>e.message).join(\",\");a.status(422).json({error:t})}else i()}},function(e,t){e.exports=require(\"@hapi/joi\")},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.pathTraversal=void 0;const r=i(a(3)),s=i(a(0));t.pathTraversal=e=>r.default.extend({type:\"path\",base:r.default.string().required(),messages:{\"path.invalid\":\"{{#label}} must resolve to a path under the configured repository\"},validate(t,a){if(!s.default.join(e,t).startsWith(e))return{value:t,errors:a.error(\"path.invalid\")}}}).path()},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.getUpdateDate=t.move=t.deleteFile=t.writeFile=t.listRepoFiles=void 0;const r=i(a(0)),s=a(1),n=async(e,t,a)=>{if(a<=0)return[];try{const i=await s.promises.readdir(e,{withFileTypes:!0}),o=await Promise.all(i.map(i=>{const s=r.default.join(e,i.name);return i.isDirectory()?n(s,t,a-1):[s].filter(e=>e.endsWith(t))}));return[].concat(...o)}catch(e){return[]}};t.listRepoFiles=async(e,t,a,i)=>(await n(r.default.join(e,t),a,i)).map(t=>t.substr(e.length+1)),t.writeFile=async(e,t)=>{await s.promises.mkdir(r.default.dirname(e),{recursive:!0}),await s.promises.writeFile(e,t)},t.deleteFile=async(e,t)=>{await s.promises.unlink(r.default.join(e,t)).catch(()=>{})};const o=async(e,t)=>{await s.promises.mkdir(r.default.dirname(t),{recursive:!0}),await s.promises.rename(e,t)};t.move=async(e,t)=>{await o(e,t);const a=r.default.dirname(e),i=r.default.dirname(t),s=await n(a,\"\",100);await Promise.all(s.map(e=>o(e,e.replace(a,i))))},t.getUpdateDate=async(e,t)=>s.promises.stat(r.default.join(e,t)).then(e=>e.mtime).catch(()=>new Date)},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.readMediaFile=t.entriesFromFiles=void 0;const r=i(a(16)),s=i(a(0)),n=a(1),o=e=>r.default.createHash(\"sha256\").update(e).digest(\"hex\"),l=e=>e.replace(/\\\\/g,\"/\");t.entriesFromFiles=async(e,t)=>Promise.all(t.map(async t=>{try{const a=await n.promises.readFile(s.default.join(e,t.path));return{data:a.toString(),file:{path:l(t.path),label:t.label,id:o(a)}}}catch(e){return{data:null,file:{path:l(t.path),label:t.label,id:null}}}})),t.readMediaFile=async(e,t)=>{const a=await n.promises.readFile(s.default.join(e,t));return{id:o(a),content:a.toString(\"base64\"),encoding:\"base64\",path:l(t),name:s.default.basename(t)}}},function(e,t){e.exports=require(\"express\")},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.registerCommonMiddlewares=void 0;const r=i(a(7)),s=i(a(9)),n=i(a(10));t.registerCommonMiddlewares=(e,t)=>{const{logger:a}=t,i={write:e=>{a.debug(String(e).trim())}};e.use(s.default(\"combined\",{stream:i})),e.use(n.default()),e.use(r.default.json({limit:\"50mb\"}))}},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"cors\")},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.registerMiddleware=t.localGitMiddleware=t.getSchema=t.validateRepo=void 0;const r=i(a(0)),s=a(1),n=a(12),o=a(13),l=a(2),c=i(a(14)),d=a(15),u=a(4),p=a(5),f=a(6),m=async(e,t)=>{await e.add(\".\"),await e.commit(t,void 0,{\"--no-verify\":null,\"--no-gpg-sign\":null})},h=async e=>await e.branchLocal().then(e=>e.current),y=async(e,t,a)=>{const i=await h(e);try{i!==t&&await e.checkout(t);return await a()}finally{await e.checkout(i)}},g=e=>`branch.${e}.description`,w=async(e,t,a,i,s)=>{await Promise.all(a.map(e=>p.writeFile(r.default.join(t,e.path),e.raw))),await Promise.all(i.map(e=>p.writeFile(r.default.join(t,e.path),Buffer.from(e.content,e.encoding)))),a.every(e=>e.newPath)&&a.forEach(async e=>{await p.move(r.default.join(t,e.path),r.default.join(t,e.newPath))}),await m(e,s)},b=async(e,t)=>await e.branchLocal().then(({all:e})=>e.includes(t)),F=async(e,t,a)=>{const i=await e.diff([t,a]);return o.parse(i).map(e=>{var t,a;const i=(null===(t=e.oldPath)||void 0===t?void 0:t.replace(/b\\//,\"\"))||\"\",r=(null===(a=e.newPath)||void 0===a?void 0:a.replace(/b\\//,\"\"))||\"\",s=r||i;return{oldPath:i,newPath:r,status:e.status,newFile:\"added\"===e.status,path:s,id:s,binary:e.binary||/.svg$/.test(s)}})};t.validateRepo=async({repoPath:e})=>{const t=c.default(e).silent(!1);if(!await t.checkIsRepo())throw Error(e+\" is not a valid git repository\")},t.getSchema=({repoPath:e})=>l.defaultSchema({path:u.pathTraversal(e)}),t.localGitMiddleware=({repoPath:e,logger:t})=>{const a=c.default(e).silent(!1),i=d.withTimeout(new d.Mutex,3e3,new Error(\"Request timed out\"));return async function(o,l){let c;try{c=await i.acquire();const{body:t}=o;if(\"info\"===t.action)return void l.json({repo:r.default.basename(e),publish_modes:[\"simple\",\"editorial_workflow\"],type:\"local_git\"});const{branch:d}=t.params;if(!await b(a,d)){const e=`Default branch '${d}' doesn't exist`;return void l.status(422).json({error:e})}switch(t.action){case\"entriesByFolder\":{const i=t.params,{folder:r,extension:s,depth:n}=i,o=await y(a,d,()=>p.listRepoFiles(e,r,s,n).then(t=>f.entriesFromFiles(e,t.map(e=>({path:e})))));l.json(o);break}case\"entriesByFiles\":{const i=t.params,r=await y(a,d,()=>f.entriesFromFiles(e,i.files));l.json(r);break}case\"getEntry\":{const i=t.params,[r]=await y(a,d,()=>f.entriesFromFiles(e,[{path:i.path}]));l.json(r);break}case\"unpublishedEntries\":{const e=await a.branchLocal().then(e=>e.all.filter(e=>e.startsWith(n.CMS_BRANCH_PREFIX+\"/\")));l.json(e.map(n.contentKeyFromBranch));break}case\"unpublishedEntry\":{let{id:i,collection:r,slug:s,cmsLabelPrefix:o}=t.params;i&&({collection:r,slug:s}=n.parseContentKey(i));const c=n.generateContentKey(r,s),u=n.branchFromContentKey(c);if(!await b(a,u))return l.status(404).json({message:\"Not Found\"});{const t=await F(a,d,u),i=await a.raw([\"config\",g(u)]),c=i&&n.labelToStatus(i.trim(),o||\"\"),f=t.length>=0?await y(a,u,async()=>(await Promise.all(t.map(({newPath:t})=>p.getUpdateDate(e,t)))).reduce((e,t)=>e>t?e:t)):new Date,m={collection:r,slug:s,status:c,diffs:t,updatedAt:f};l.json(m)}break}case\"unpublishedEntryDataFile\":{const{path:i,collection:r,slug:s}=t.params,o=n.generateContentKey(r,s),c=n.branchFromContentKey(o),[d]=await y(a,c,()=>f.entriesFromFiles(e,[{path:i}]));l.json({data:d.data});break}case\"unpublishedEntryMediaFile\":{const{path:i,collection:r,slug:s}=t.params,o=n.generateContentKey(r,s),c=n.branchFromContentKey(o),d=await y(a,c,()=>f.readMediaFile(e,i));l.json(d);break}case\"deleteUnpublishedEntry\":{const{collection:e,slug:i}=t.params,r=n.generateContentKey(e,i),s=n.branchFromContentKey(r);await h(a)===s&&await a.checkoutLocalBranch(d),await a.branch([\"-D\",s]),l.json({message:\"deleted branch: \"+s});break}case\"persistEntry\":{const{cmsLabelPrefix:i,entry:o,dataFiles:c=[o],assets:u,options:p}=t.params;if(p.useWorkflow){const t=c[0].slug,o=p.collectionName,l=n.generateContentKey(o,t),f=n.branchFromContentKey(l);await y(a,d,async()=>{const t=await b(a,f);t?await a.checkout(f):await a.checkoutLocalBranch(f),await(async(e,t)=>{const a=await e.raw([\"config\",\"commit.gpgsign\"]);try{\"true\"===a&&await e.addConfig(\"commit.gpgsign\",\"false\"),await e.rebase([t,\"--no-verify\"])}finally{\"true\"===a&&await e.addConfig(\"commit.gpgsign\",a)}})(a,d);const o=(await F(a,d,f)).filter(e=>e.binary&&!u.map(e=>e.path).includes(e.path));if(await Promise.all(o.map(t=>s.promises.unlink(r.default.join(e,t.path)))),await w(a,e,c,u,p.commitMessage),!t){const e=n.statusToLabel(p.status,i||\"\");await a.addConfig(g(f),e)}})}else await y(a,d,async()=>{await w(a,e,c,u,p.commitMessage)});l.json({message:\"entry persisted\"});break}case\"updateUnpublishedEntryStatus\":{const{collection:e,slug:i,newStatus:r,cmsLabelPrefix:s}=t.params,o=n.generateContentKey(e,i),c=n.branchFromContentKey(o),u=n.statusToLabel(r,s||\"\");await a.addConfig(g(c),u),l.json({message:`${d} description was updated to ${u}`});break}case\"publishUnpublishedEntry\":{const{collection:e,slug:i}=t.params,r=n.generateContentKey(e,i),s=n.branchFromContentKey(r);await(async(e,t,a)=>{const i=await e.raw([\"config\",\"commit.gpgsign\"]);try{\"true\"===i&&await e.addConfig(\"commit.gpgsign\",\"false\"),await e.mergeFromTo(t,a)}finally{\"true\"===i&&await e.addConfig(\"commit.gpgsign\",i)}})(a,s,d),await a.deleteLocalBranch(s),l.json({message:`branch ${s} merged to ${d}`});break}case\"getMedia\":{const{mediaFolder:i}=t.params,r=await y(a,d,async()=>{const t=await p.listRepoFiles(e,i,\"\",1);return await Promise.all(t.map(t=>f.readMediaFile(e,t)))});l.json(r);break}case\"getMediaFile\":{const{path:i}=t.params,r=await y(a,d,()=>f.readMediaFile(e,i));l.json(r);break}case\"persistMedia\":{const{asset:i,options:{commitMessage:s}}=t.params,n=await y(a,d,async()=>(await p.writeFile(r.default.join(e,i.path),Buffer.from(i.content,i.encoding)),await m(a,s),f.readMediaFile(e,i.path)));l.json(n);break}case\"deleteFile\":{const{path:i,options:{commitMessage:r}}=t.params;await y(a,d,async()=>{await p.deleteFile(e,i),await m(a,r)}),l.json({message:\"deleted file \"+i});break}case\"deleteFiles\":{const{paths:i,options:{commitMessage:r}}=t.params;await y(a,d,async()=>{await Promise.all(i.map(t=>p.deleteFile(e,t))),await m(a,r)}),l.json({message:\"deleted files \"+i.join(\", \")});break}case\"getDeployPreview\":l.json(null);break;default:{const e=\"Unknown action \"+t.action;l.status(422).json({error:e});break}}}catch(e){t.error(`Error handling ${JSON.stringify(o.body)}: ${e.message}`),l.status(500).json({error:\"Unknown error\"})}finally{c&&c()}}},t.registerMiddleware=async(e,a)=>{const{logger:i}=a,s=r.default.resolve(process.env.GIT_REPO_DIRECTORY||process.cwd());await t.validateRepo({repoPath:s}),e.post(\"/api/v1\",l.joi(t.getSchema({repoPath:s}))),e.post(\"/api/v1\",t.localGitMiddleware({repoPath:s,logger:i})),i.info(\"Netlify CMS Git Proxy Server configured with \"+s)}},function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.branchFromContentKey=t.contentKeyFromBranch=t.parseContentKey=t.generateContentKey=t.statusToLabel=t.labelToStatus=t.isCMSLabel=t.MERGE_COMMIT_MESSAGE=t.DEFAULT_PR_BODY=t.CMS_BRANCH_PREFIX=void 0,t.CMS_BRANCH_PREFIX=\"cms\",t.DEFAULT_PR_BODY=\"Automatically generated by Netlify CMS\",t.MERGE_COMMIT_MESSAGE=\"Automatically generated. Merged on Netlify CMS.\";const i=e=>e||\"netlify-cms/\";t.isCMSLabel=(e,t)=>e.startsWith(i(t)),t.labelToStatus=(e,t)=>e.substr(i(t).length),t.statusToLabel=(e,t)=>`${i(t)}${e}`,t.generateContentKey=(e,t)=>`${e}/${t}`,t.parseContentKey=e=>{const t=e.indexOf(\"/\");return{collection:e.substr(0,t),slug:e.substr(t+1)}},t.contentKeyFromBranch=e=>e.substring((t.CMS_BRANCH_PREFIX+\"/\").length),t.branchFromContentKey=e=>`${t.CMS_BRANCH_PREFIX}/${e}`},function(e,t){e.exports=require(\"what-the-diff\")},function(e,t){e.exports=require(\"simple-git/promise\")},function(e,t){e.exports=require(\"async-mutex\")},function(e,t){e.exports=require(\"crypto\")},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.registerMiddleware=t.getSchema=t.localFsMiddleware=void 0;const r=i(a(0)),s=a(2),n=a(4),o=a(5),l=a(6);t.localFsMiddleware=({repoPath:e,logger:t})=>async function(a,i){try{const{body:t}=a;switch(t.action){case\"info\":i.json({repo:r.default.basename(e),publish_modes:[\"simple\"],type:\"local_fs\"});break;case\"entriesByFolder\":{const a=t.params,{folder:r,extension:s,depth:n}=a,c=await o.listRepoFiles(e,r,s,n).then(t=>l.entriesFromFiles(e,t.map(e=>({path:e}))));i.json(c);break}case\"entriesByFiles\":{const a=t.params,r=await l.entriesFromFiles(e,a.files);i.json(r);break}case\"getEntry\":{const a=t.params,[r]=await l.entriesFromFiles(e,[{path:a.path}]);i.json(r);break}case\"persistEntry\":{const{entry:a,dataFiles:s=[a],assets:n}=t.params;await Promise.all(s.map(t=>o.writeFile(r.default.join(e,t.path),t.raw))),await Promise.all(n.map(t=>o.writeFile(r.default.join(e,t.path),Buffer.from(t.content,t.encoding)))),s.every(e=>e.newPath)&&s.forEach(async t=>{await o.move(r.default.join(e,t.path),r.default.join(e,t.newPath))}),i.json({message:\"entry persisted\"});break}case\"getMedia\":{const{mediaFolder:a}=t.params,r=await o.listRepoFiles(e,a,\"\",1),s=await Promise.all(r.map(t=>l.readMediaFile(e,t)));i.json(s);break}case\"getMediaFile\":{const{path:a}=t.params,r=await l.readMediaFile(e,a);i.json(r);break}case\"persistMedia\":{const{asset:a}=t.params;await o.writeFile(r.default.join(e,a.path),Buffer.from(a.content,a.encoding));const s=await l.readMediaFile(e,a.path);i.json(s);break}case\"deleteFile\":{const{path:a}=t.params;await o.deleteFile(e,a),i.json({message:\"deleted file \"+a});break}case\"deleteFiles\":{const{paths:a}=t.params;await Promise.all(a.map(t=>o.deleteFile(e,t))),i.json({message:\"deleted files \"+a.join(\", \")});break}case\"getDeployPreview\":i.json(null);break;default:{const e=\"Unknown action \"+t.action;i.status(422).json({error:e});break}}}catch(e){t.error(`Error handling ${JSON.stringify(a.body)}: ${e.message}`),i.status(500).json({error:\"Unknown error\"})}},t.getSchema=({repoPath:e})=>s.defaultSchema({path:n.pathTraversal(e)}),t.registerMiddleware=async(e,a)=>{const{logger:i}=a,n=r.default.resolve(process.env.GIT_REPO_DIRECTORY||process.cwd());e.post(\"/api/v1\",s.joi(t.getSchema({repoPath:n}))),e.post(\"/api/v1\",t.localFsMiddleware({repoPath:n,logger:i})),i.info(\"Netlify CMS File System Proxy Server configured with \"+n)}},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.createLogger=void 0;const r=i(a(19)),{combine:s,colorize:n,simple:o}=r.default.format;t.createLogger=({level:e})=>r.default.createLogger({level:e,format:s(n(),o()),transports:[new r.default.transports.Console]})},function(e,t){e.exports=require(\"winston\")},function(e,t,a){\"use strict\";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,\"__esModule\",{value:!0}),a(21).config();const r=i(a(7)),s=a(8),n=a(11),o=a(17),l=a(18),c=r.default(),d=process.env.PORT||8081,u=process.env.LOG_LEVEL||\"info\";(async()=>{const e=l.createLogger({level:u}),t={logger:e};s.registerCommonMiddlewares(c,t);try{const e=process.env.MODE||\"fs\";if(\"fs\"===e)o.registerMiddleware(c,t);else{if(\"git\"!==e)throw new Error(`Unknown proxy mode '${e}'`);n.registerMiddleware(c,t)}}catch(t){e.error(t.message),process.exit(1)}c.listen(d,()=>{e.info(\"Netlify CMS Proxy Server listening on port \"+d)})})()},function(e,t){e.exports=require(\"dotenv\")}]);","extractedComments":[]}